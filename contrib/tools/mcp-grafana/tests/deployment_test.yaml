suite: test mcp-grafana deployment
templates:
  - deployment.yaml
tests:
  - it: should render deployment with default values
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: metadata.name
          value: RELEASE-NAME-mcp-grafana
      - equal:
          path: spec.replicas
          value: 1
      - hasDocuments:
          count: 1

  - it: should render deployment with custom replica count
    set:
      replicaCount: 3
    asserts:
      - equal:
          path: spec.replicas
          value: 3

  - it: should have correct container image
    asserts:
      - equal:
          path: spec.template.spec.containers[0].name
          value: mcp-grafana
      - equal:
          path: spec.template.spec.containers[0].image
          value: docker.io/mcp/grafana:latest

  - it: should use custom image tag when set
    set:
      image:
        tag: "v1.0.0"
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: docker.io/mcp/grafana:v1.0.0

  - it: should have correct service account name
    asserts:
      - equal:
          path: spec.template.spec.serviceAccountName
          value: RELEASE-NAME-mcp-grafana

  - it: should have correct container port
    asserts:
      - equal:
          path: spec.template.spec.containers[0].ports[0].containerPort
          value: 8000

  - it: should have correct labels
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: mcp-grafana
      - equal:
          path: metadata.labels["app.kubernetes.io/instance"]
          value: RELEASE-NAME
      - equal:
          path: spec.template.metadata.labels["app.kubernetes.io/name"]
          value: mcp-grafana
      - equal:
          path: spec.template.metadata.labels["app.kubernetes.io/instance"]
          value: RELEASE-NAME